# ProtoTonic - C++ Zero-IDL Protobuf-like Serialization

## é¡¹ç›®çŠ¶æ€
![GitHub](https://img.shields.io/github/stars/gqw/MeegooProto?style=social)
<!-- ![CI/CD](https://github.com/gqw/MeegooProto/actions/workflows/ci.yml/badge.svg) -->
![Version](https://img.shields.io/github/v/release/gqw/MeegooProto)
![License](https://img.shields.io/badge/License-MIT-blue.svg)


## é¡¹ç›®æè¿°
MeeGooProto æ˜¯ä¸€ä¸ªåŸºäºC++11/17æ¨¡æ¿å…ƒç¼–ç¨‹çš„åºåˆ—åŒ–æ¡†æ¶ï¼Œé€šè¿‡ç¼–è¯‘æœŸåå°„å’Œè‡ªåŠ¨ç±»å‹æ¨å¯¼æŠ€æœ¯ï¼Œå®ç°æ— éœ€IDLæ–‡ä»¶å³å¯å®ç°é«˜æ•ˆProtobufæ ¼å¼åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œã€‚å®ƒåœ¨ä¿æŒC++åŸç”Ÿç±»å‹ç³»ç»Ÿçš„åŒæ—¶ï¼Œæä¾›æ¥è¿‘æ‰‹å†™åºåˆ—åŒ–ä»£ç çš„æ€§èƒ½è¡¨ç°ï¼Œç‰¹åˆ«é€‚åˆå¯¹æ€§èƒ½æ•æ„Ÿä¸”éœ€è¦çµæ´»æ•°æ®ç»“æ„çš„ç°ä»£C++é¡¹ç›®ã€‚


## æ ¸å¿ƒç‰¹æ€§
- âœ… **é›¶IDLå¼€å‘**ï¼šç›´æ¥ä½¿ç”¨C++ç»“æ„ä½“/ç±»è¿›è¡Œåºåˆ—åŒ–ï¼Œæ— éœ€ç¼–å†™é¢å¤–æè¿°æ–‡ä»¶
- âœ… **ç¼–è¯‘æœŸä¼˜åŒ–**ï¼šåˆ©ç”¨constexpråå°„ç”Ÿæˆåºåˆ—åŒ–ä»£ç ï¼Œæ¶ˆé™¤è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥å¼€é”€
- âœ… **é«˜æ€§èƒ½å®ç°**ï¼šæ¯”Google Protobufå¿«xxxå€ï¼ˆæ ¹æ®æµ‹è¯•ç”¨ä¾‹ï¼‰
- âœ… **é›¶æ‹·è´æ”¯æŒ**ï¼šæ”¯æŒç›´æ¥åºåˆ—åŒ–åˆ°é¢„åˆ†é…å†…å­˜æˆ–æµå¯¹è±¡
- âœ… **è·¨å¹³å°å…¼å®¹**ï¼šæ”¯æŒLinux/macOS/Windowsï¼Œå·²é€šè¿‡Clang/GCC/MSVCæµ‹è¯•
- âœ… **å¼ºç±»å‹ä¿éšœ**ï¼šé€šè¿‡ç¼–è¯‘æœŸçº¦æŸç¡®ä¿åºåˆ—åŒ–å®‰å…¨æ€§ï¼Œé¿å…ç±»å‹ä¸åŒ¹é…é”™è¯¯

<!--
## æ€§èƒ½å¯¹æ¯”

| æµ‹è¯•ç”¨ä¾‹          | ProtoTonic | Protobuf 3.21 | é€Ÿåº¦æå‡ | å†…å­˜å ç”¨ |
|-------------------|------------|---------------|----------|----------|
| ç®€å•ç»“æ„ä½“        | 0.35Î¼s     | 1.2Î¼s         | 3.4x     | å‡å°‘38%  |
| åµŒå¥—å¯¹è±¡          | 0.89Î¼s     | 3.1Î¼s         | 3.5x     | å‡å°‘42%  |
| å¤§æ•°æ®é‡æ•°ç»„      | 2.1Î¼s      | 7.9Î¼s         | 3.8x     | å‡å°‘45%  |

ï¼ˆæµ‹è¯•ç¯å¢ƒï¼šIntel i7-12700K, Ubuntu 22.04, Clang 15.0ï¼‰ -->


## ä½¿ç”¨ç¤ºä¾‹
```cpp

    TestAllData data;
    //  1,i32: 00001,000 10011100 11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111 00000001
    data.i32 = -100;
    //  2,i64: 00010,000 10011100 11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111 00000001
    data.i64 = -100;
    //  3,u32: 00011,000 01100100
    data.u32 = 100;
    //  4,u64: 00100,000 01100100
    data.u64 = 100;
    //  5,si32: 00101,000 11000111 00000001
    data.si32 = -100;
    //  6,si64: 00110,000 11000111 00000001
    data.si64 = -100;
    //  7,fx32: 00111,101 10011100 11111111 11111111 11111111
    data.fx32 = 100;
    //  8,fx64: 01000,001 10011100 11111111 11111111 11111111 11111111 11111111 11111111 11111111
    data.fx64 = 100;
    // 9,sfx32: 01001,101 10011100 11111111 11111111 11111111
    data.sfx32 = -100;
    //10,sfx64: 01010,001 10011100 11111111 11111111 11111111 11111111 11111111 11111111 11111111
    data.sfx64 = -100;
    //   11,bl: 01011,000 00000001
    data.bl = true;
    //  12,f32: 01100,101 01100100 00000000 00000000 00000000
    data.f32 = 100.0f;
    //  13,d64: 01101,001 01100100 00000000 00000000 00000000 00000000 00000000 00000000 00000000
    data.d64 = 100.0;
    //  14,str: 01110,010 00000011 00110001 00110000 00110000
    data.str = "100";
    //  15,bs:  01111,010 00000011 00000001 00000010 00000011
    data.bs = {1, 2, 3};
    //  16,vec: 10000,000 00000001 00000011 10000000 00000001 00000100 10000000 00000001 00000101
    data.vec = {3, 4, 5};
    //  17,mp:
    data.mp = {{1, 2}, {3, 4}};
    //  18,test:
    data.substruct = {100, 100, 10.0f};
    //  20,variant struct:
    data.variant = std::string("100");
    data.i32_2 = -200;
    // 21,any:
    data.any = {{"type.googleapis.com/pb.SubTest", 100}};

    std::string out;
    out.resize(pb_size(data));
    std::cout << "*** pb_size: " << out.size() << std::endl;
    auto ret = to_pb(data, out);
    std::cout << "size: " << out.size() << std::endl;
    for (size_t i = 0; i < out.size(); i++) {
        std::bitset<8> bits(out[i]);
        std::cout << std::hex  << bits << " ";
        if (i % 10 == 9) {
            std::cout << std::endl;
        }
    }
    std::cout << std::dec << std::endl;

    TestAllData data2;
    from_pb(data2, out);
    std::cout << "i32: " << data2.i32 << std::endl;
    std::cout << "si32: " << data2.si32 << std::endl;
    std::cout << "i32_2: " << data2.i32_2 << std::endl;
    return 0;

```

### å®‰è£…æ–¹æ³•
```bash

# æ„å»º
git clone https://github.com/gqw/MeegooProto.git
cd MeegooProto
mkdir build && cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
make -j$(nproc)

```

### æ–‡æ¡£ä¸ç¤¾åŒº
- ğŸ“š åœ¨çº¿æ–‡æ¡£
- ğŸ’¬ Discord ç¤¾åŒº
- ğŸ“¢ åšå®¢æ•™ç¨‹

### è´¡çŒ®æŒ‡å—
æ¬¢è¿æäº¤ PR æ”¹è¿›æ€§èƒ½æˆ–æ·»åŠ æ–°åŠŸèƒ½ï¼Œè¯·éµå¾ªï¼š
- ä¿æŒä»£ç ç¬¦åˆ C++20 æ ‡å‡†
- æ·»åŠ å®Œæ•´çš„å•å…ƒæµ‹è¯•
- æ€§èƒ½æ•æ„Ÿä»£ç éœ€æä¾›åŸºå‡†æµ‹è¯•æ•°æ®

### è®¸å¯è¯
MIT License - å…è®¸å•†ä¸šä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘ï¼Œä½†éœ€ä¿ç•™ç‰ˆæƒå£°æ˜ã€‚

### è”ç³»ä¿¡æ¯
- ğŸ“§ ç»´æŠ¤è€…é‚®ç®±ï¼šgqwmail@qq.com
- ğŸŒ é¡¹ç›®å®˜ç½‘ï¼šhttps://gqw.github.io

# æŠ€æœ¯ä¼˜åŠ¿è§£æ
1. ç¼–è¯‘æœŸåå°„ï¼š
    - é€šè¿‡ std::tuple å’Œ std::variant å®ç°ç±»å‹ä¿¡æ¯æå–ï¼Œæ— éœ€è¿è¡Œæ—¶ç±»å‹æ“¦é™¤
    - é€šè¿‡ constexpr å®ç°ç¼–è¯‘å™¨æ¡ä»¶åˆ¤å®šï¼Œé¿å…è¿è¡Œæ—¶å¼€é”€
2. ä¼˜åŒ–åºåˆ—åŒ–ç­–ç•¥ï¼š
    - è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜åºåˆ—åŒ–æ ¼å¼ï¼ˆå¦‚å˜é•¿æ•´æ•°ã€ç´§å‡‘æ•°ç»„ï¼‰
3. å†…å­˜ç®¡ç†ï¼š
    - æ”¯æŒé¢„åˆ†é…å†…å­˜ç¼“å†²åŒº
3. å…¼å®¹æ€§å¢å¼ºï¼š
    - æ”¯æŒåµŒå¥—çš„ STL å®¹å™¨ï¼ˆvector/map/variant/anyï¼‰